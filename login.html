<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Agrofy - Login</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="navbar">
  <div class="navbar-logo" onclick="window.location.href='index.html'">
    <img src="logo.jpeg" alt="Agrofy Logo" />
    <span>Agrofy</span>
  </div>
  <nav class="navbar-links">
    <a href="register.html" data-i18="registerNow">Register</a>
  </nav>
</header>

<div class="container">
  <h2 data-i18="loginTitle" style="text-align:center;margin-top:20px">Login</h2>

  <form id="loginForm" style="max-width:420px;margin:14px auto;">
    <input type="email" id="email" data-i18-placeholder="emailPlaceholder" placeholder="Email" required />
    <input type="password" id="password" data-i18-placeholder="passwordPlaceholder" placeholder="Password" required />
    <button type="submit" data-i18="loginBtn">Login</button>
  </form>
</div>


<script src="userStatus.js"></script>
<script>
const USER_API = "https://script.google.com/macros/s/AKfycbwAGJsclDN5hMGjQrudkgFbvTwFQMOjzuHWHQaUOZbU7N3wwmLzjbUh51QJXDADmB4qNA/exec";

function jsonpCall(url, callbackName) {
  return new Promise((resolve, reject) => {
    window[callbackName] = (data) => {
      resolve(data);
      delete window[callbackName];
      script.remove();
    };
    const script = document.createElement("script");
    script.src = `${url}&callback=${callbackName}`;
    script.onerror = () => reject(new Error("JSONP request failed"));
    document.body.appendChild(script);
  });
}

document.getElementById('loginForm').onsubmit = async function(e) {
  e.preventDefault();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  
  if (!email || !password) {
    alert('Please enter email and password');
    return;
  }

  const url = `${USER_API}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`;

  try {
    const data = await jsonpCall(url, 'handleLoginResponse');
    if (data.status === 'success') {
      const user = data.user;
      localStorage.setItem('userEmail', user.email);
      localStorage.setItem('userType', user.type);
      localStorage.setItem('verified', user.verified);
      sessionStorage.setItem('userName', user.name || user.email.split('@')[0]);
      sessionStorage.setItem('profile_complete', user.profile_complete || 'no');
      alert('Login successful!');
      window.location.href = 'index.html';
    } else {
      alert(data.message || 'Login failed');
    }
  } catch (err) {
    alert('Error logging in');
  }
};
</script>
<footer class="footer">
  <div class="footer-container">
    <div class="footer-about">
      <h3 data-i18="footerAboutTitle">About Agrofy</h3>
      <p data-i18="footerAboutText">
        Agrofy connects farmers, buyers, and transporters for seamless trade of fresh agricultural products and services.
      </p>
    </div>

    <div class="footer-links">
      <h3 data-i18="footerQuickLinks">Quick Links</h3>
      <ul>
        <li><a href="contact.html" data-i18="contact">Contact</a></li>
        <li><a href="faq.html" data-i18="faq">FAQ</a></li>
      </ul>
    </div>

    <div class="footer-social">
      <h3 data-i18="footerFollowUs">Follow Us</h3>
      <div class="social-icons">
        <a href="https://facebook.com" target="_blank"><img src="https://cdn-icons-png.flaticon.com/128/1384/1384005.png" alt="Facebook" /></a>
        <a href="https://twitter.com" target="_blank"><img src="https://cdn-icons-png.flaticon.com/128/5969/5969020.png" alt="Twitter" /></a>
        <a href="https://instagram.com" target="_blank"><img src="https://cdn-icons-png.flaticon.com/128/3955/3955024.png" alt="Instagram" /></a>
        <a href="https://youtube.com" target="_blank"><img src="https://cdn-icons-png.flaticon.com/128/3670/3670147.png" alt="YouTube" /></a>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <p>&copy; <span id="year"></span> Agrofy. <span data-i18="footerRights">All rights reserved.</span></p>
  </div>
</footer>

<script>
document.getElementById("year").textContent = new Date().getFullYear();
</script>
</body>
</html>
