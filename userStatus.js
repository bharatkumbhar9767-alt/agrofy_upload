document.addEventListener('DOMContentLoaded', () => {
  const USER_API = "https://script.google.com/macros/s/AKfycbwAGJsclDN5hMGjQrudkgFbvTwFQMOjzuHWHQaUOZbU7N3wwmLzjbUh51QJXDADmB4qNA/exec";

// --- Translations ---
const translations = {
  en: {
    home: "Home",
    products: "Products & Services",
    contact: "Contact",
    logout: "Logout",
    farmerUpload: "Farmer Upload",
    loginBtn: "Login",
    registerNow: "Register Now",
    welcome: "Welcome",
    invalidCredentials: "Invalid credentials or account not verified.",
    accountPendingVerification: "Your account is pending admin verification.",
    loginFailed: "Login failed. Please try again.",
    uploadFailed: "Upload failed",
    completeProfile: "Complete Profile",
    profile: "Profile",
    editProfile: "Edit Profile",
    pendingVerification: " (Pending verification)",

    // ЁЯСЗ NEW
    welcomeAgrofy: "Welcome to Agrofy",
    empoweringText: "Empowering farmers and connecting buyers with fresh, quality agricultural products and services.",
    addToCart: "Add to Cart",
    registerTitle: "Register",
    namePlaceholder: "Name",
    emailPlaceholder: "Email",
    passwordPlaceholder: "Password",
    selectType: "-- Select User Type --",
    buyerOption: "Buyer",
    farmerOption: "Farmer",
    transportOption: "Transport",
    phonePlaceholder: "Phone",
    addressPlaceholder: "Address",
    idTypeLabel: "Select ID Type:",
    govtDoc: "Government Document",
    selfDecl: "Self Declaration",
    farmSizePlaceholder: "Farm size (optional)",
    businessPlaceholder: "Business (optional)",
    vehiclePlaceholder: "Vehicle (optional)",
    licensePlaceholder: "License (optional)",
    registerBtn: "Register",
    uploadTitle: "ЁЯУд Upload Your Product or Service",
  productName: "Product/Service Name",
  selectType: "-- Select Type --",
  productOption: "Product",
  serviceOption: "Service",
  description: "Description",
  price: "Price (тВ╣)",
  quantity: "Quantity",
  imageUpload: "Upload Image",
  uploadBtn: "Upload for Verification",
  loginTitle: "Login",
  emailPlaceholder: "Email",
  passwordPlaceholder: "Password",
  loginBtn: "Login",
    contactTitle: "Contact Us",
  contactName: "Your Name",
  contactEmail: "Your Email",
  contactMessage: "Your Message",
  sendMessageBtn: "Send Message",
    faq: "FAQ",
  faqTitle: "Frequently Asked Questions",
  faq1q: "Who can register on Agrofy?",
  faq1a: "Farmers, buyers, and transport providers can register on Agrofy to connect and grow their business.",
  faq2q: "How do I upload my products?",
  faq2a: "After login, verified users can go to the upload page, fill details, and submit for admin verification.",
  faq3q: "Is Agrofy free to use?",
  faq3a: "Yes, Agrofy is completely free for all users to register, connect, and explore services.",
  faq4q: "How can I contact support?",
  faq4a: "You can visit our Contact page or send an email through the contact form available there."

  },
  hi: {
    home: "рдореБрдЦрдкреГрд╖реНрда",
    products: "рдЙрддреНрдкрд╛рдж рдФрд░ рд╕реЗрд╡рд╛рдПрдБ",
    contact: "рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ",
    logout: "рд▓реЙрдЧрдЖрдЙрдЯ",
    farmerUpload: "рдХрд┐рд╕рд╛рди рдЕрдкрд▓реЛрдб",
    loginBtn: "рд▓реЙрдЧрд┐рди",
    registerNow: "рдЕрднреА рд░рдЬрд┐рд╕реНрдЯрд░ рдХрд░реЗрдВ",
    welcome: "рд╕реНрд╡рд╛рдЧрдд",
    invalidCredentials: "рдЧрд▓рдд рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВред",
    accountPendingVerification: "рдЖрдкрдХрд╛ рдЕрдХрд╛рдЙрдВрдЯ рдПрдбрдорд┐рди рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП рд▓рдВрдмрд┐рдд рд╣реИред",
    loginFailed: "рд▓реЙрдЧрд┐рди рд╡рд┐рдлрд▓ рд░рд╣рд╛ред рдХреГрдкрдпрд╛ рдлрд┐рд░ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред",
    uploadFailed: "рдЕрдкрд▓реЛрдб рд╡рд┐рдлрд▓",
    completeProfile: "рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдкреВрд░реА рдХрд░реЗрдВ",
    profile: "рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓",
    editProfile: "рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ",
    pendingVerification: " (рд╕рддреНрдпрд╛рдкрди рд▓рдВрдмрд┐рдд)",

    // ЁЯСЗ NEW
    welcomeAgrofy: "рдПрдЧреНрд░реЛрдлрд╛рдИ рдореЗрдВ рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ",
    empoweringText: "рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рд╕рд╢рдХреНрдд рдмрдирд╛рдирд╛ рдФрд░ рдЦрд░реАрджрд╛рд░реЛрдВ рдХреЛ рддрд╛рдЬрд╝рд╛, рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддрд╛ рд╡рд╛рд▓реЗ рдХреГрд╖рд┐ рдЙрддреНрдкрд╛рджреЛрдВ рдФрд░ рд╕реЗрд╡рд╛рдУрдВ рд╕реЗ рдЬреЛрдбрд╝рдирд╛ред",
    addToCart: "рдХрд╛рд░реНрдЯ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ",
    registerTitle: "рдкрдВрдЬреАрдХрд░рдг",
namePlaceholder: "рдирд╛рдо",
emailPlaceholder: "рдИрдореЗрд▓",
passwordPlaceholder: "рдкрд╛рд╕рд╡рд░реНрдб",
selectType: "-- рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░рдХрд╛рд░ рдЪреБрдиреЗрдВ --",
buyerOption: "рдЦрд░реАрджрд╛рд░",
farmerOption: "рдХрд┐рд╕рд╛рди",
transportOption: "рдкрд░рд┐рд╡рд╣рди",
phonePlaceholder: "рдлрд╝реЛрди",
addressPlaceholder: "рдкрддрд╛",
idTypeLabel: "рдкрд╣рдЪрд╛рди рдкреНрд░рдХрд╛рд░ рдЪреБрдиреЗрдВ:",
govtDoc: "рд╕рд░рдХрд╛рд░реА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝",
selfDecl: "рд╕реНрд╡-рдШреЛрд╖рдгрд╛",
farmSizePlaceholder: "рдЦреЗрддреА рдХрд╛ рдЖрдХрд╛рд░ (рд╡реИрдХрд▓реНрдкрд┐рдХ)",
businessPlaceholder: "рд╡реНрдпрд╡рд╕рд╛рдп (рд╡реИрдХрд▓реНрдкрд┐рдХ)",
vehiclePlaceholder: "рд╡рд╛рд╣рди (рд╡реИрдХрд▓реНрдкрд┐рдХ)",
licensePlaceholder: "рд▓рд╛рдЗрд╕реЗрдВрд╕ (рд╡реИрдХрд▓реНрдкрд┐рдХ)",
registerBtn: "рдкрдВрдЬреАрдХрд░рдг рдХрд░реЗрдВ",
  uploadTitle: "ЁЯУд рдЕрдкрдирд╛ рдЙрддреНрдкрд╛рдж рдпрд╛ рд╕реЗрд╡рд╛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ",
  productName: "рдЙрддреНрдкрд╛рдж/рд╕реЗрд╡рд╛ рдХрд╛ рдирд╛рдо",
  selectType: "-- рдкреНрд░рдХрд╛рд░ рдЪреБрдиреЗрдВ --",
  productOption: "рдЙрддреНрдкрд╛рдж",
  serviceOption: "рд╕реЗрд╡рд╛",
  description: "рд╡рд┐рд╡рд░рдг",
  price: "рдХреАрдордд (тВ╣)",
  quantity: "рдорд╛рддреНрд░рд╛",
  imageUpload: "рдЫрд╡рд┐ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ",
  uploadBtn: "рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ",
    loginTitle: "рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ",
  emailPlaceholder: "рдИрдореЗрд▓",
  passwordPlaceholder: "рдкрд╛рд╕рд╡рд░реНрдб",
  loginBtn: "рд▓реЙрдЧрд┐рди рдХрд░реЗрдВ",
    contactTitle: "рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ",
  contactName: "рдЖрдкрдХрд╛ рдирд╛рдо",
  contactEmail: "рдЖрдкрдХрд╛ рдИрдореЗрд▓",
  contactMessage: "рдЖрдкрдХрд╛ рд╕рдВрджреЗрд╢",
  sendMessageBtn: "рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВ",
    faq: "рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рд╢реНрди",
  faqTitle: "рдЕрдХреНрд╕рд░ рдкреВрдЫреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рд╢реНрди",
  faq1q: "Agrofy рдкрд░ рдХреМрди рдкрдВрдЬреАрдХрд░рдг рдХрд░ рд╕рдХрддрд╛ рд╣реИ?",
  faq1a: "рдХрд┐рд╕рд╛рди, рдЦрд░реАрджрд╛рд░ рдФрд░ рдкрд░рд┐рд╡рд╣рди рдкреНрд░рджрд╛рддрд╛ Agrofy рдкрд░ рдкрдВрдЬреАрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдирд╛ рд╡реНрдпрд╡рд╕рд╛рдп рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред",
  faq2q: "рдореИрдВ рдЕрдкрдиреЗ рдЙрддреНрдкрд╛рдж рдХреИрд╕реЗ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ?",
  faq2a: "рд▓реЙрдЧрд┐рди рдХреЗ рдмрд╛рдж, рд╕рддреНрдпрд╛рдкрд┐рдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрд▓реЛрдб рдкреЗрдЬ рдкрд░ рдЬрд╛рдХрд░ рд╡рд┐рд╡рд░рдг рднрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред",
  faq3q: "рдХреНрдпрд╛ Agrofy рдХрд╛ рдЙрдкрдпреЛрдЧ рдореБрдлреНрдд рд╣реИ?",
  faq3a: "рд╣рд╛рдБ, Agrofy рд╕рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдореБрдлреНрдд рд╣реИред",
  faq4q: "рдореИрдВ рд╕рд╣рд╛рдпрддрд╛ рд╕реЗ рдХреИрд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ?",
  faq4a: "рдЖрдк рд╣рдорд╛рд░реЗ рд╕рдВрдкрд░реНрдХ рдкреЗрдЬ рдкрд░ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рд╡рд╣рд╛рдБ рдЙрдкрд▓рдмреНрдз рд╕рдВрдкрд░реНрдХ рдлреЙрд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдИрдореЗрд▓ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред"

  },
  mr: {
    home: "рдореБрдЦрдкреГрд╖реНрда",
    products: "рдЙрддреНрдкрд╛рджрдиреЗ рдЖрдгрд┐ рд╕реЗрд╡рд╛",
    contact: "рд╕рдВрдкрд░реНрдХ",
    logout: "рд▓реЙрдЧрдЖрдЙрдЯ",
    farmerUpload: "рд╢реЗрддрдХрд░реА рдЕрдкрд▓реЛрдб",
    loginBtn: "рд▓реЙрдЧрд┐рди",
    registerNow: "рдиреЛрдВрджрдгреА рдХрд░рд╛",
    welcome: "рд╕реНрд╡рд╛рдЧрдд рдЖрд╣реЗ",
    invalidCredentials: "рдЕрд╡реИрдз рдХреНрд░реЗрдбреЗрдиреНрд╢рд┐рдЕрд▓ рдХрд┐рдВрд╡рд╛ рдЦрд╛рддрдВ рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╛рд╣реА.",
    accountPendingVerification: "рддреБрдордЪреЗ рдЦрд╛рддреЗ рдЕреЕрдбрдорд┐рдирдЪреА рдкрдбрддрд╛рд│рдгреА рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрд╣реЗ.",
    loginFailed: "рд▓реЙрдЧрд┐рди рдЕрдпрд╢рд╕реНрд╡реА. рдХреГрдкрдпрд╛ рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.",
    uploadFailed: "рдЕрдкрд▓реЛрдб рдЕрдпрд╢рд╕реНрд╡реА",
    completeProfile: "рдкреНрд░реЛрдлрд╛рдИрд▓ рдкреВрд░реНрдг рдХрд░рд╛",
    profile: "рдкреНрд░реЛрдлрд╛рдИрд▓",
    editProfile: "рдкреНрд░реЛрдлрд╛рдИрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рд╛",
    pendingVerification: " (рдкреНрд░рддреАрдХреНрд╖рд╛ рдЭрд╛рд▓реА рдЖрд╣реЗ)",

    // ЁЯСЗ NEW
    welcomeAgrofy: "рдЕтАНреЕрдЧреНрд░реЛрдлрд╛рдпрдордзреНрдпреЗ рдЖрдкрд▓реЗ рд╕реНрд╡рд╛рдЧрдд рдЖрд╣реЗ",
    empoweringText: "рд╢реЗрддрдХрд▒реНрдпрд╛рдВрдирд╛ рд╕рдХреНрд╖рдо рдмрдирд╡рдгреЗ рдЖрдгрд┐ рдЦрд░реЗрджреАрджрд╛рд░рд╛рдВрдирд╛ рддрд╛рдЬреНрдпрд╛, рдЙрдЪреНрдЪ-рдЧреБрдгрд╡рддреНрддреЗрдЪреНрдпрд╛ рдХреГрд╖реА рдЙрддреНрдкрд╛рджрдирд╛рдВрд╢реА рдЖрдгрд┐ рд╕реЗрд╡рд╛рдВрд╢реА рдЬреЛрдбрдгреЗ.",
    addToCart: "рдХрд╛рд░реНрдЯрдордзреНрдпреЗ рдЬреЛрдбрд╛",
    registerTitle: "рдиреЛрдВрджрдгреА",
namePlaceholder: "рдирд╛рд╡",
emailPlaceholder: "рдИрдореЗрд▓",
passwordPlaceholder: "рдкрд╛рд╕рд╡рд░реНрдб",
selectType: "-- рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рдкреНрд░рдХрд╛рд░ рдирд┐рд╡рдбрд╛ --",
buyerOption: "рдЦрд░реЗрджреАрджрд╛рд░",
farmerOption: "рд╢реЗрддрдХрд░реА",
transportOption: "рд╡рд╛рд╣рддреВрдХ",
phonePlaceholder: "рдлреЛрди",
addressPlaceholder: "рдкрддреНрддрд╛",
idTypeLabel: "рдУрд│рдЦ рдкреНрд░рдХрд╛рд░ рдирд┐рд╡рдбрд╛:",
govtDoc: "рд╢рд╛рд╕рдХреАрдп рджрд╕реНрддрдРрд╡рдЬ",
selfDecl: "рд╕реНрд╡рдШреЛрд╖рдгрд╛",
farmSizePlaceholder: "рд╢реЗрддреАрдЪрд╛ рдЖрдХрд╛рд░ (рдкрд░реНрдпрд╛рдпреА)",
businessPlaceholder: "рд╡реНрдпрд╡рд╕рд╛рдп (рдкрд░реНрдпрд╛рдпреА)",
vehiclePlaceholder: "рд╡рд╛рд╣рди (рдкрд░реНрдпрд╛рдпреА)",
licensePlaceholder: "рдкрд░рд╡рд╛рдирд╛ (рдкрд░реНрдпрд╛рдпреА)",
registerBtn: "рдиреЛрдВрджрдгреА рдХрд░рд╛",
  uploadTitle: "ЁЯУд рддреБрдордЪрд╛ рдЙрддреНрдкрд╛рджрди рдХрд┐рдВрд╡рд╛ рд╕реЗрд╡рд╛ рдЕрдкрд▓реЛрдб рдХрд░рд╛",
  productName: "рдЙрддреНрдкрд╛рджрди/рд╕реЗрд╡реЗрдЪреЗ рдирд╛рд╡",
  selectType: "-- рдкреНрд░рдХрд╛рд░ рдирд┐рд╡рдбрд╛ --",
  productOption: "рдЙрддреНрдкрд╛рджрди",
  serviceOption: "рд╕реЗрд╡рд╛",
  description: "рд╡рд░реНрдгрди",
  price: "рдХрд┐рдВрдордд (тВ╣)",
  quantity: "рдкреНрд░рдорд╛рдг",
  imageUpload: "рдкреНрд░рддрд┐рдорд╛ рдЕрдкрд▓реЛрдб рдХрд░рд╛",
  uploadBtn: "рдкрдбрддрд╛рд│рдгреАрд╕рд╛рдареА рдЕрдкрд▓реЛрдб рдХрд░рд╛",
    loginTitle: "рд▓реЙрдЧрд┐рди рдХрд░рд╛",
  emailPlaceholder: "рдИрдореЗрд▓",
  passwordPlaceholder: "рдкрд╛рд╕рд╡рд░реНрдб",
  loginBtn: "рд▓реЙрдЧрд┐рди рдХрд░рд╛",
    contactTitle: "рдЖрдордЪреНрдпрд╛рд╢реА рд╕рдВрдкрд░реНрдХ рд╕рд╛рдзрд╛",
  contactName: "рддреБрдордЪреЗ рдирд╛рд╡",
  contactEmail: "рддреБрдордЪрд╛ рдИрдореЗрд▓",
  contactMessage: "рддреБрдордЪрд╛ рд╕рдВрджреЗрд╢",
  sendMessageBtn: "рд╕рдВрджреЗрд╢ рдкрд╛рдард╡рд╛",
    faq: "рдиреЗрд╣рдореА рд╡рд┐рдЪрд╛рд░рд▓реЗ рдЬрд╛рдгрд╛рд░реЗ рдкреНрд░рд╢реНрди",
  faqTitle: "рд╡рд╛рд░рдВрд╡рд╛рд░ рд╡рд┐рдЪрд╛рд░рд▓реЗ рдЬрд╛рдгрд╛рд░реЗ рдкреНрд░рд╢реНрди",
  faq1q: "Agrofy рд╡рд░ рдХреЛрдг рдиреЛрдВрджрдгреА рдХрд░реВ рд╢рдХрддреЛ?",
  faq1a: "рд╢реЗрддрдХрд░реА, рдЦрд░реЗрджреАрджрд╛рд░ рдЖрдгрд┐ рд╡рд╛рд╣рддреВрдХрджрд╛рд░ Agrofy рд╡рд░ рдиреЛрдВрджрдгреА рдХрд░реВрди рдЖрдкрд▓рд╛ рд╡реНрдпрд╡рд╕рд╛рдп рд╡рд╛рдврд╡реВ рд╢рдХрддрд╛рдд.",
  faq2q: "рдореА рдорд╛рдЭреА рдЙрддреНрдкрд╛рджрдиреЗ рдХрд╢реА рдЕрдкрд▓реЛрдб рдХрд░реВ рд╢рдХрддреЛ?",
  faq2a: "рд▓реЙрдЧрд┐рди рдХреЗрд▓реНрдпрд╛рдирдВрддрд░, рд╕рддреНрдпрд╛рдкрд┐рдд рд╡рд╛рдкрд░рдХрд░реНрддреЗ рдЕрдкрд▓реЛрдб рдкреГрд╖реНрдард╛рд╡рд░ рдЬрд╛рдКрди рддрдкрд╢реАрд▓ рднрд░реВ рд╢рдХрддрд╛рдд рдЖрдгрд┐ рдкрдбрддрд╛рд│рдгреАрд╕рд╛рдареА рд╕рдмрдорд┐рдЯ рдХрд░реВ рд╢рдХрддрд╛рдд.",
  faq3q: "Agrofy рд╡рд╛рдкрд░рдгреНрдпрд╛рд╕рд╛рдареА рдореЛрдлрдд рдЖрд╣реЗ рдХрд╛?",
  faq3a: "рд╣реЛрдп, Agrofy рд╕рд░реНрд╡ рд╡рд╛рдкрд░рдХрд░реНрддреНрдпрд╛рдВрд╕рд╛рдареА рдкреВрд░реНрдгрдкрдгреЗ рдореЛрдлрдд рдЖрд╣реЗ.",
  faq4q: "рдореА рд╕рд╣рд╛рдпреНрдпрд╛рд╢реА рдХрд╕рд╛ рд╕рдВрдкрд░реНрдХ рд╕рд╛рдзреВ рд╢рдХрддреЛ?",
  faq4a: "рддреБрдореНрд╣реА рдЖрдордЪреНрдпрд╛ рд╕рдВрдкрд░реНрдХ рдкреГрд╖реНрдард╛рд▓рд╛ рднреЗрдЯ рджреЗрдК рд╢рдХрддрд╛ рдХрд┐рдВрд╡рд╛ рддрд┐рдереЗ рдЙрдкрд▓рдмреНрдз рдЕрд╕рд▓реЗрд▓реНрдпрд╛ рдлреЙрд░реНрдорджреНрд╡рд╛рд░реЗ рдИрдореЗрд▓ рдкрд╛рдард╡реВ рд╢рдХрддрд╛."


  }
};
// Get saved language or default to English
let lang = sessionStorage.getItem('lang') || 'en';

// Apply translations to elements
function applyTranslations() {
  document.querySelectorAll('[data-i18]').forEach(el => {
    const key = el.getAttribute('data-i18');
    if (translations[lang] && translations[lang][key]) el.textContent = translations[lang][key];
  });
  document.querySelectorAll('[data-i18-placeholder]').forEach(el => {
    const key = el.getAttribute('data-i18-placeholder');
    if (translations[lang] && translations[lang][key]) el.placeholder = translations[lang][key];
  });
}

// Set language
function setLang(newLang) {
  lang = newLang;
  sessionStorage.setItem('lang', lang);
  applyTranslations();

  // Update sticky button text
  const btn = document.getElementById('langToggleBtn');
  if (btn) {
    btn.textContent = lang.toUpperCase();
    btn.classList.add('pulse');
    setTimeout(() => btn.classList.remove('pulse'), 300);
  }
}


  // Language toggle

  // Fetch user by email
  async function findUserByEmail(email){
    const res = await fetch(USER_API+`?action=find&email=${encodeURIComponent(email)}`);
    const data = await res.json();
    return data.user || null;
  }

  async function updateNav() {
    const navLinks = document.querySelector('.navbar-links');
    if (!navLinks) return;

    // Clear previous dynamic links
    Array.from(navLinks.querySelectorAll('.dynamic-link, .user-dropdown')).forEach(el=>el.remove());

    const email = localStorage.getItem('userEmail') || '';
    const userType = localStorage.getItem('userType') || '';
    const verified = localStorage.getItem('verified') || 'no';
    const profileComplete = sessionStorage.getItem('profile_complete') || 'no';

    // Left and right container
    navLinks.innerHTML = `<div class="navbar-left">
        <a href="index.html" data-i18="home">Home</a>
        <a href="products.html" data-i18="products">Products & Services</a>
      </div>
      <div class="navbar-right">
        <a href="contact.html" data-i18="contact">Contact</a>
      </div>`;

    const rightContainer = navLinks.querySelector('.navbar-right');

    if(!email){
      // Login/Register dropdown
      const dropdown = document.createElement('div');
      dropdown.className = 'dynamic-dropdown user-dropdown';
      dropdown.innerHTML = `<button>${translations[lang].loginBtn}/${translations[lang].registerNow}</button>
        <div class="dropdown-content">
          <a href="login.html">${translations[lang].loginBtn}</a>
          <a href="register.html">${translations[lang].registerNow}</a>
        </div>`;
      rightContainer.appendChild(dropdown);
      dropdown.querySelector('button').addEventListener('click',(e)=>{ e.stopPropagation(); dropdown.classList.toggle('show'); });
      window.addEventListener('click',()=>dropdown.classList.remove('show'));
    } else {
      // Logged in user dropdown
      const userDropdown = document.createElement('div');
      userDropdown.className = 'dynamic-dropdown user-dropdown';
      const displayName = sessionStorage.getItem('userName') || email.split('@')[0];
      userDropdown.innerHTML = `<button>ЁЯСд ${translations[lang].welcome}, ${displayName}</button>
        <div class="dropdown-content"></div>`;
      const ddContent = userDropdown.querySelector('.dropdown-content');

      // Profile / Complete profile
      const profileLink = document.createElement('a');
      profileLink.href = 'profile.html';
      profileLink.textContent = (profileComplete==='yes' || verified==='yes')?translations[lang].profile:translations[lang].completeProfile;
      ddContent.appendChild(profileLink);

      // Farmer upload if farmer & verified
      if(userType==='farmer' && verified==='yes'){
        const farmerLink = document.createElement('a');
        farmerLink.href = 'farmer_upload.html';
        farmerLink.textContent = translations[lang].farmerUpload;
        ddContent.appendChild(farmerLink);
      }

      // Logout
      const logoutLink = document.createElement('a');
      logoutLink.href='#';
      logoutLink.textContent = translations[lang].logout;
      logoutLink.addEventListener('click', (e)=>{
        e.preventDefault();
        if(confirm('Are you sure you want to logout?')){
          localStorage.clear();
          sessionStorage.clear();
          alert('Logged out successfully!');
          setTimeout(()=>window.location.href='index.html',500);
        }
      });
      ddContent.appendChild(logoutLink);

      rightContainer.appendChild(userDropdown);
      userDropdown.querySelector('button').addEventListener('click',(e)=>{ e.stopPropagation(); userDropdown.classList.toggle('show'); });
      window.addEventListener('click',()=>userDropdown.classList.remove('show'));
    }
    applyTranslations();
  }
  // Create sticky language button outside navbar
if (!document.getElementById('langToggleBtn')) {
  const langBtn = document.createElement('button');
  langBtn.id = 'langToggleBtn';
  langBtn.className = 'lang-switch';
  langBtn.textContent = lang.toUpperCase();
  langBtn.title = 'Change Language';

  // Sticky CSS
  langBtn.style.cssText = `
    position: fixed;
    top: 80px;          /* below navbar */
    right: 20px;        /* distance from right edge */
    padding: 8px 14px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: #4CAF50; /* visible background */
    color: hsla(0, 20%, 99%, 1.00);      /* ensure visible text */
    font-weight: 600;
    cursor: pointer;
    z-index: 999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
  `;

  document.body.appendChild(langBtn);

  // Dropdown menu
  const menu = document.createElement('div');
  menu.id = 'langMenu';
  menu.style.cssText = `
    position: fixed;
    top: 120px;      /* below button */
    right: 20px;
    background: #d2f175ff;
    padding: 8px;
    border-radius: 12px;
    display: none;
    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    z-index: 1000;
    min-width: 140px;
    
  `;
  menu.innerHTML = `
    <div style="padding:10px; cursor:pointer;" data-lang="en">ЁЯЗмЁЯЗз English</div>
    <div style="padding:10px; cursor:pointer;" data-lang="hi">ЁЯЗоЁЯЗ│ рд╣рд┐рдиреНрджреА</div>
    <div style="padding:10px; cursor:pointer;" data-lang="mr">ЁЯЗоЁЯЗ│ рдорд░рд╛рдареА</div>
  `;
  document.body.appendChild(menu);

  // Toggle dropdown
  langBtn.addEventListener('click', e => {
    e.stopPropagation();
    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
  });

  // Language selection
  menu.querySelectorAll('[data-lang]').forEach(item => {
    item.addEventListener('click', () => {
      setLang(item.getAttribute('data-lang'));
      menu.style.display = 'none';
      updateNav(); // refresh navbar links if needed
    });
  });

  // Close menu when clicking outside
  window.addEventListener('click', () => { menu.style.display = 'none'; });
}



  applyTranslations();
  updateNav();

  window.Agrofy = {
    setLang,
    getLang: ()=>lang,
    updateNav,
    findUserByEmail
  };
});
